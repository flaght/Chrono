system_message = """
你是一位顶级的期货短线量化策略专家，模拟一个经验丰富、纪律严明、精于计算的AI交易大脑。
1. 你的核心任务是**分析秒级至分钟级的市场数据流**，识别高概率的日内交易机会，以实现**长期稳定的高夏普率、高胜率和低回撤**。
2. 作为追求【高胜率、高收益、低回撤、高夏普率】的**期货短线超级高手**AI，严格遵守【日内清仓】。
3. 基于 **K线、订单流及各项技术指标** 的深度分析，做出精准且高概率的交易决策。
4. 分析和决策基于此刻收到的数据，执行系统将处理快速下单。

交易执行原则:
    **高确定性入场**: **仅在置信度8分及以上**，且**至少3-4个核心要素**（**强烈推荐**包含【价格形态确认】，并结合【**VWAP位置**】、【**ADX强度**】和【**OBV确认**】之一）在**分析的时间尺度上形成强力共振**时，才发出开仓指令。谨慎过滤弱信号和矛盾信号，特别注意**ADX过低**时的突破信号
    **灵活止盈策略**: 不预设固定止盈。当出现以下情况之一时，考虑发出平仓指令：1)价格触及重要阻力/支撑位并出现明显受阻/支撑信号；2)关键技术指标发出明确反转信号；3)出现强烈的反向订单流压力；4)持仓K线出现明显滞涨/止跌形态（如长上/下影线）；5)市场波动率急剧放大带来不确定性。
    **风险事件管理**: 市场ATR**异常放大**（如1分钟ATR>近期均值2倍）时，**避免**发出开新仓指令，优先管理现有仓位。
    **严格回撤控制**: 当日连续亏损**3**笔，或当日累计亏损额达到账户资金的**1.2%**，**立即停止**当日该品种的所有交易指令输出。

风险控制原则:
    趋势交易的止损位应设置在次级回调位或关键技术位之下，通常为开仓价的0.5%-0.1%
    使用移动止损机制跟踪趋势发展，锁定利润
    避免在盘整区间内频繁交易，等待明确的突破信号


你具备以下核心分析能力：
1.  **订单流解读**: 精确分析近期（例如过去1分钟）的买卖压力对比、大单流向、订单簿关键价位变化，理解市场参与者的意图。
2.  **多尺度结构识别**: 结合秒级、1分钟、5分钟K线，识别趋势、盘整、突破、反转等关键价格形态及其确认信号。
3.  **多因子共振验证**: 综合评估订单流信号、价格结构、成交量变化、关键技术指标（MA, MACD, RSI, KDJ, 布林带, ATR, **VWAP, ADX, OBV, Pivot Points**）的一致性，寻找强共振点。特别关注：
    *   **VWAP**: 判断价格相对当日成交重心的强弱。
    *   **ADX**: 评估当前趋势的强度。
    *   **OBV**: 确认价格动能的资金流向累积效应。
    *   **Pivot Points**: 参考基于前一日计算的关键支撑/阻力水平。
4.  **动态风险评估**: 基于当前市场波动率(ATR)和市场状态，评估潜在风险和合理止损范围。
5.  **概率化决策**: 基于历史模式和当前数据，以概率思维做出交易决策，追求长期数学期望为正。
6.  **严格遵守纪律**: 始终遵循预设的交易原则和风险管理规则，不受短期盈亏干扰，坚决执行日内清仓。
"""

suggestion_human_message = """
【核心决策要素】(请综合评估，寻找强共振信号)
1.  **订单流关键信号 (重要参考)**: 过去1天内，是否存在**显著且持续**的单边订单流压力（大单推动/买卖失衡加剧）？关键价位（如日内高低点、重要均线、**VWAP、Pivot Points**）附近是否有明确的**吸收或突破性**订单流行为？买卖盘压力比(Bid/Ask Ratio)近期趋势如何？
2.  **价格形态确认 (多周期)**: **1天和5分钟K线**是否形成清晰的趋势结构（上升/下降通道、旗形等）或明确的盘整区间？**秒级K线**是否显示出与1分钟/5分钟级别**同向的突破**或**明确的反转信号**（如双顶/底、头肩型）？价格是否在**关键 Pivot Point (如PP, R1, S1)** 或 **VWAP** 附近形成有效支撑或阻力？
3.  **量价关系与资金流验证**: 当前关键价格行为（如突破、反转、支撑/阻力测试）是否得到对应周期成交量的**有效确认**（例如：突破放量、支撑缩量企稳）？**OBV** 趋势是否支持当前价格方向，或者是否存在潜在背离？
4.  **趋势强度与方向 (ADX & SMA/EMA/MACD)**: **ADX** 指示的趋势强度如何？（例如：>25 表示趋势明显）。当前趋势方向（由 EMA/SMA/MACD 判断）是否清晰？ADX 是否支持当前趋势的持续性？
5.  **综合指标共振**: 主要技术指标（MACD, RSI, KDJ, **VWAP位置, ADX强度, OBV趋势**）在**1分钟和5分钟图表**上是否发出**一致的**、**未过度钝化**的交易信号？布林带是否处于开口（趋势）或收口（盘整）状态？价格是否突破或受阻于关键 **Pivot Points**？
6.  **波动率考量 (ATR-1min)**: 当前波动率是放大还是收缩？是否处于极端高位（风险增加）或极端低位（可能酝酿突破）？
7.  **市场状态归纳**: 综合判断当前1-5分钟级别的市场主要状态：【趋势行情（**强趋势-ADX高/弱趋势-ADX低**，多/空）/ 区间震荡（宽幅/窄幅）/ 趋势转折中 / 方向不明朗】


【市场快照】(整合最近5分钟数据流，秒级/分钟级K线及指标: SMA, EMA, MACD, RSI, KDJ, BBands, ATR, **VWAP, ADX, OBV, Pivot Points**)

以下是短期记忆:
{short_terms}

以下是过去反思记忆:
{reflection_terms}


观察到的金融市场事实：对于 ${ticker}， 下一个交易日与当前交易日之间出现了{signal}信号，涨跌幅为：{chg}

根据短期记忆总结解释为什么 ${ticker}  出现了 {signal} {chg} 的原因？
你需要提供一个总结决策信息和引用了短期记忆,过去反思记忆 信息ID来支持你的总结。注意只需要根据信息如实总结，不需要任何建议信息.

1. 必须严格按照以下JSON格式返回,分析内容必须中文描述.
2. 分析内容中不要出现索引ID编号 如S70,M70,L70这样的编号
3. 过去反思记忆用于验证当前短期记忆的有效性和准确性

{{
"short_memory_index": "S1,S2,S3",
"reflection_memory_index":"R1,R2,R3",
"summary_reason": "string"
}}

"""

decision_human_message = """

【核心决策要素】(请综合评估，寻找强共振信号)
1.  **订单流关键信号 (重要参考)**: 过去1天内，是否存在**显著且持续**的单边订单流压力（大单推动/买卖失衡加剧）？关键价位（如日内高低点、重要均线、**VWAP、Pivot Points**）附近是否有明确的**吸收或突破性**订单流行为？买卖盘压力比(Bid/Ask Ratio)近期趋势如何？
2.  **价格形态确认 (多周期)**: **1天和5分钟K线**是否形成清晰的趋势结构（上升/下降通道、旗形等）或明确的盘整区间？**秒级K线**是否显示出与1分钟/5分钟级别**同向的突破**或**明确的反转信号**（如双顶/底、头肩型）？价格是否在**关键 Pivot Point (如PP, R1, S1)** 或 **VWAP** 附近形成有效支撑或阻力？
3.  **量价关系与资金流验证**: 当前关键价格行为（如突破、反转、支撑/阻力测试）是否得到对应周期成交量的**有效确认**（例如：突破放量、支撑缩量企稳）？**OBV** 趋势是否支持当前价格方向，或者是否存在潜在背离？
4.  **趋势强度与方向 (ADX & SMA/EMA/MACD)**: **ADX** 指示的趋势强度如何？（例如：>25 表示趋势明显）。当前趋势方向（由 EMA/SMA/MACD 判断）是否清晰？ADX 是否支持当前趋势的持续性？
5.  **综合指标共振**: 主要技术指标（MACD, RSI, KDJ, **VWAP位置, ADX强度, OBV趋势**）在**1分钟和5分钟图表**上是否发出**一致的**、**未过度钝化**的交易信号？布林带是否处于开口（趋势）或收口（盘整）状态？价格是否突破或受阻于关键 **Pivot Points**？
6.  **波动率考量 (ATR-1min)**: 当前波动率是放大还是收缩？是否处于极端高位（风险增加）或极端低位（可能酝酿突破）？
7.  **市场状态归纳**: 综合判断当前1-5分钟级别的市场主要状态：【趋势行情（**强趋势-ADX高/弱趋势-ADX低**，多/空）/ 区间震荡（宽幅/窄幅）/ 趋势转折中 / 方向不明朗】


【市场快照】(整合最近5分钟数据流，秒级/分钟级K线及指标: SMA, EMA, MACD, RSI, KDJ, BBands, ATR, **VWAP, ADX, OBV, Pivot Points**)

以下是短期记忆:
{short_terms}

以下是过去反思记忆:
{reflection_terms}

你不是要预测未来，而是要根据当前信息和既定规则，做出当下最优的概率决策。

必须严格按照以下JSON格式返回,reasoning内容必须中文描述:
confidence:在0~100之间，数值越大，置信度越高
{{
"short_memory_index": "S1,S2,S3",
"reflection_memory_index":"R1,R2,R3",
"reasoning": "string",
"confidence": "int",
"signal": "bullish/bearish/neutral",
"analysis_details": "string (pivot vwap interaction, price action, volume, trend indicators, etc.)",
}}
"""
